# SPDX-FileCopyrightText: (c) 2021-2025 Jeff C. Jensen
# SPDX-License-Identifier: MIT

services:
  roon:
    container_name: roon-server
    build:
      context: .
    image: roon-server:latest
    restart: unless-stopped
    init: true
    network_mode: host
    group_add:
      - "${AUDIO_GID:-29}" # set AUDIO_GID=$(getent group audio | cut -d: -f3)
    environment:
      TZ: "America/Los_Angeles"
    volumes:
      - ${HOME}/music:/music:ro # TODO: replace ~/music with your music directory
      - roon-server-data:/opt/RoonServer
      - roon-server-cache:/var/roon
      - /run/udev:/run/udev:ro
      - /etc/localtime:/etc/localtime:ro
    stop_grace_period: 45s
    logging:
      driver: local
    devices:
      - /dev/bus/usb
      - /dev/snd
    # # if using bridged network mode:
    # ports:
    #   - "9003:9003/udp"               # multicast
    #   - "9100-9200:9100-9200/tcp"     # Roon API and RAAT
    #   - "9330-9339:9330-9339/tcp"     # remoting/brokerserver and Roon Display
    #   - "30000-30010:30000-30010/tcp" # Chromecast
    #   - "55000:55000/tcp"             # Roon ARC

volumes:
  roon-server-data:
    name: roon-server-data
  roon-server-cache:
    name: roon-server-cache

## try using this if roon is having trouble discovering devices
# cap_add:
#   - SYS_ADMIN
#   - DAC_READ_SEARCH
# security_opt:
#   - apparmor:unconfined
